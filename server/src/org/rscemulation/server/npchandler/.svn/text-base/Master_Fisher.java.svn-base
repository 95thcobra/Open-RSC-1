package org.rscemulation.server.npchandler;

import org.rscemulation.server.event.ShortEvent;
import org.rscemulation.server.model.ChatMessage;
import org.rscemulation.server.model.InvItem;
import org.rscemulation.server.model.Npc;
import org.rscemulation.server.model.Player;
import org.rscemulation.server.model.World;

public class Master_Fisher implements NpcHandler {
	public void handleNpc(final Npc npc, Player player) throws Exception {
		String wildernessState;
		String fishName;
		int fishID;	
		if (!World.getWildernessState()) {
			fishID = 367;
			//fishID = 373;
			wildernessState = "F2P";
			fishName = "Tuna";
			//fishName = "Lobster";
		} else {
			fishID = 555;
			wildernessState = "P2P";
			fishName = "Bass";
		}
		final int finalFishID = fishID;
		final String finalFishName = fishName;
		player.informOfNpcMessage(new ChatMessage(npc, "The wilderness is " + wildernessState + ", have some " + finalFishName + ".", player));
		player.setBusy(true);
		World.getDelayedEventHandler().add(new ShortEvent(player) {
			public void action() {
				World.getDelayedEventHandler().add(new ShortEvent(owner) {
					public void action() {
						while(owner.getInventory().size() < 30) {
							owner.setBusy(false);
							owner.getInventory().add(new InvItem(finalFishID, 1));
							owner.getActionSender().sendInventory();
							npc.unblock();
							if(owner.getInventory().size() == 30) {																npc.unblock();
								break;
							}
						}
						owner.setBusy(false);
						npc.unblock();
					}
				});
			}
		});
		npc.blockedBy(player);
	}
}
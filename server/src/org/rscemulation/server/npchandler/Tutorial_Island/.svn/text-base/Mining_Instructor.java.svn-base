/**
* Generated By NPCScript :: A scripting engine created for RSCEmulation by Zilent
*/
package org.rscemulation.server.npchandler.Tutorial_Island;
import org.rscemulation.server.event.DelayedQuestChat;
import org.rscemulation.server.event.SingleEvent;
import org.rscemulation.server.model.InvItem;
import org.rscemulation.server.model.Npc;
import org.rscemulation.server.model.Player;
import org.rscemulation.server.model.Quest;
import org.rscemulation.server.model.World;
import org.rscemulation.server.npchandler.NpcHandler;
public class Mining_Instructor implements NpcHandler {
	public void handleNpc(final Npc npc, final Player owner) throws Exception {
		npc.blockedBy(owner);
		owner.setBusy(true);
		Quest q = owner.getQuest(100);
		if(q != null) {
			switch(q.getStage()) {
				case 12:
					mineChatA(npc, owner);
					break;
				case 13:
					mineChatB(npc, owner);
					break;
				case 14:
					mineChatC(npc, owner, true);
					break;
				default:
					mineChatC(npc, owner, false);
			}
		}
	}
	
	private void mineChatA(final Npc npc, final Player owner) {
		ServerBootstrap.getDefaultInstance().getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"Good day to you"}, true) {
			public void finished() {
				ServerBootstrap.getDefaultInstance().getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Hello I'm a veteran miner!", "I'm here to show you how to mine", "If you want to quickly find out what is in a rock you can prospect it", "right click on this rock here", "and select prospect"}) {
					public void finished() {
						owner.setBusy(false);
						npc.unblock();
					}
				});
			}
		});
	}
	
	private void mineChatB(final Npc npc, final Player owner) {
		if(owner.getInventory().countId(156) == 0) {
			ServerBootstrap.getDefaultInstance().getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"There's tin ore in that rock"}, true) {
				public void finished() {
					ServerBootstrap.getDefaultInstance().getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Yes, that's what's in there", "Ok you need to get that tin out of the rock", "First of all you need a pick", "And here we have a pick"}) {
						public void finished() {
							owner.getActionSender().sendMessage("The instructor somehow produces a large pickaxe from inside his jacket");
							ServerBootstrap.getDefaultInstance().getDelayedEventHandler().add(new SingleEvent(owner, 1500) {
								public void action() {
									owner.getInventory().add(new InvItem(156, 1));
									owner.getActionSender().sendMessage("The instructor gives you the pickaxe");
									ServerBootstrap.getDefaultInstance().getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Now hit those rocks"}) {
										public void finished() {
											owner.setBusy(false);
											npc.unblock();
										}
									});	
								}
							});

						}
					});
				}
			});
		} else {
			ServerBootstrap.getDefaultInstance().getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"There's tin ore in that rock"}, true) {
				public void finished() {
					ServerBootstrap.getDefaultInstance().getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Yes, that's what's in there", "Ok you need to get that tin out of the rock", "Now hit those rocks"}) {
						public void finished() {
							owner.setBusy(false);
							npc.unblock();
						}
					});
				}
			});
		}
	}
	
	private void mineChatC(final Npc npc, final Player owner, final boolean incStage) {
		ServerBootstrap.getDefaultInstance().getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Very good", "If at a later date you can find a rock with copper ore", "You can take the copper ore and tin ore to a furnace", "use them on the furnace to make bronze bars", "which you can then either sell", "or use on anvils with a hammer", "To make weapons", "As your mining and smithing levels grow", "you will be able to mine various exciting new metals", "now go through the next door to speak to the bankers"}, true) {
			public void finished() {
				if(incStage)
					owner.incQuestCompletionStage(100);
				owner.setBusy(false);
				npc.unblock();
			}
		});
	}
}
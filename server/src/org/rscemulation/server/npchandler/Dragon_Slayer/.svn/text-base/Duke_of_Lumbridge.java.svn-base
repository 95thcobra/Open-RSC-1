package org.rscemulation.server.npchandler.Dragon_Slayer;

import org.rscemulation.server.event.DelayedQuestChat;
import org.rscemulation.server.event.SingleEvent;
import org.rscemulation.server.model.ChatMessage;
import org.rscemulation.server.model.InvItem;
import org.rscemulation.server.model.MenuHandler;
import org.rscemulation.server.model.Npc;
import org.rscemulation.server.model.Player;
import org.rscemulation.server.model.World;
import org.rscemulation.server.npchandler.NpcHandler;

public class Duke_of_Lumbridge implements NpcHandler {
	public void handleNpc(final Npc npc, Player owner) throws Exception {
		npc.blockedBy(owner);
		owner.setBusy(true);		
		if(owner.getInventory().countId(420) == 0) {
			World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Hello, welcome to my castle."}, true) {
				public void finished() {
					World.getDelayedEventHandler().add(new SingleEvent(owner, 1500) {
						public void action() {
							final String[] options2 = {"I seek a shield that will protect me from dragon breath", "Have you any quests for me?", "Where can I find money?"};
							owner.setBusy(false);
							owner.getActionSender().sendMenu(options2);
							owner.setMenuHandler(new MenuHandler(options2) {
								public void handleReply(final int option, final String reply) {
									owner.setBusy(true);
									for(Player informee : owner.getViewArea().getPlayersInView()) {
										informee.informOfChatMessage(new ChatMessage(owner, reply, npc));
									}
									switch(option) {
										case 0:
											final String[] messages6 = {"A knight going on a dragon quest hmm?", "A most worthy cause", "Guard this well my friend"};
											World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, messages6) {
												public void finished() {
													owner.getActionSender().sendMessage("The duke hands you a shield");
													owner.getInventory().add(new InvItem(420, 1));
													owner.sendInventory();
													owner.setBusy(false);
													npc.unblock();
												}
											});
											break;
										case 1:
											final String[] messages7 = {"All is well for me"};
											World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, messages7) {
												public void finished() {
													owner.setBusy(false);
													npc.unblock();
												}
											});
											break;
										case 2:
											final String[] messages8 = {"I've heard that the blacksmiths are prosperous among the peasantry", "Maybe you could try your hand at that"};
											World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, messages8) {
												public void finished() {
													owner.setBusy(false);
													npc.unblock();
												}
											});
											break;
									}
								}
							});
						}
					});
				}
			});
		} else {
			World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Hello, welcome to my castle."}, true) {
				public void finished() {
					World.getDelayedEventHandler().add(new SingleEvent(owner, 1500) {
						public void action() {
							final String[] options2 = {"Have you any quests for me?", "Where can I find money?"};
							owner.setBusy(false);
							owner.getActionSender().sendMenu(options2);
							owner.setMenuHandler(new MenuHandler(options2) {
								public void handleReply(final int option, final String reply) {
									owner.setBusy(true);
									for(Player informee : owner.getViewArea().getPlayersInView()) {
										informee.informOfChatMessage(new ChatMessage(owner, reply, npc));
									}
									switch(option) {
										case 0:
											final String[] messages7 = {"All is well for me"};
											World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, messages7) {
												public void finished() {
													owner.setBusy(false);
													npc.unblock();
												}
											});
											break;
										case 1:
											final String[] messages8 = {"I've heard that the blacksmiths are prosperous among the peasantry", "Maybe you could try your hand at that"};
											World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, messages8) {
												public void finished() {
													owner.setBusy(false);
													npc.unblock();
												}
											});
											break;
									}
								}
							});
						}
					});
				}
			});
		}
	}
}